<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux之利用Google Authenticator实现用户双因素认证（Red Hat Enterprise Linux 6.0) | Kyle Tang&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="shortcut icon" href="/favorite.ico" type="image/jpg">
    <meta name="description" content="Today is a good day.">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.f427a9dd.js" as="script"><link rel="preload" href="/assets/js/2.d4ec38ee.js" as="script"><link rel="preload" href="/assets/js/5.ca2e4e56.js" as="script"><link rel="prefetch" href="/assets/js/10.4400d7a4.js"><link rel="prefetch" href="/assets/js/11.853205be.js"><link rel="prefetch" href="/assets/js/12.dce02ad7.js"><link rel="prefetch" href="/assets/js/13.e4cf0b12.js"><link rel="prefetch" href="/assets/js/14.af3acf86.js"><link rel="prefetch" href="/assets/js/15.f0cc7896.js"><link rel="prefetch" href="/assets/js/16.59ad786c.js"><link rel="prefetch" href="/assets/js/17.9f3e1f65.js"><link rel="prefetch" href="/assets/js/18.457e1767.js"><link rel="prefetch" href="/assets/js/19.279cd21a.js"><link rel="prefetch" href="/assets/js/20.7e88304f.js"><link rel="prefetch" href="/assets/js/21.3500451c.js"><link rel="prefetch" href="/assets/js/22.6c8fc9fb.js"><link rel="prefetch" href="/assets/js/23.ef5577be.js"><link rel="prefetch" href="/assets/js/24.586b94d4.js"><link rel="prefetch" href="/assets/js/25.19af61b7.js"><link rel="prefetch" href="/assets/js/26.0dd76792.js"><link rel="prefetch" href="/assets/js/27.82e62380.js"><link rel="prefetch" href="/assets/js/28.6e11add1.js"><link rel="prefetch" href="/assets/js/29.cd1c4636.js"><link rel="prefetch" href="/assets/js/3.17b090da.js"><link rel="prefetch" href="/assets/js/30.dd69bc5e.js"><link rel="prefetch" href="/assets/js/31.2b48ade5.js"><link rel="prefetch" href="/assets/js/32.f059b747.js"><link rel="prefetch" href="/assets/js/33.ab77f833.js"><link rel="prefetch" href="/assets/js/34.50e3bd81.js"><link rel="prefetch" href="/assets/js/35.5820c9c0.js"><link rel="prefetch" href="/assets/js/4.273d8741.js"><link rel="prefetch" href="/assets/js/6.a3b9b27d.js"><link rel="prefetch" href="/assets/js/7.a5917f45.js"><link rel="prefetch" href="/assets/js/8.047b700e.js"><link rel="prefetch" href="/assets/js/9.b3fe406b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Kyle Tang's blog" class="logo"> <span class="site-name can-hide">Kyle Tang's blog</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小工具" class="dropdown-title"><span class="title">小工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="小工具" class="mobile-dropdown-title"><span class="title">小工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线工具1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zxgj.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线工具2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用链接" class="dropdown-title"><span class="title">常用链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用链接" class="mobile-dropdown-title"><span class="title">常用链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.oschina.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开源中国
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.bootcss.com/p/git-guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  git简易指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的小伙伴" class="dropdown-title"><span class="title">小伙伴</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的小伙伴" class="mobile-dropdown-title"><span class="title">小伙伴</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://zhangqiang.work/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  兔子不咬人
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="小工具" class="dropdown-title"><span class="title">小工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="小工具" class="mobile-dropdown-title"><span class="title">小工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://tool.lu/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线工具1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.zxgj.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在线工具2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用链接" class="dropdown-title"><span class="title">常用链接</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用链接" class="mobile-dropdown-title"><span class="title">常用链接</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vuepress
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.oschina.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  开源中国
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://www.bootcss.com/p/git-guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  git简易指南
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="我的小伙伴" class="dropdown-title"><span class="title">小伙伴</span> <span class="arrow down"></span></button> <button type="button" aria-label="我的小伙伴" class="mobile-dropdown-title"><span class="title">小伙伴</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://zhangqiang.work/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  兔子不咬人
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Linux之利用Google Authenticator实现用户双因素认证（Red Hat Enterprise Linux 6.0)</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#一、google-authenticator双因素认证" class="sidebar-link">一、Google-Authenticator双因素认证</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#二、linux上的实现方式" class="sidebar-link">二、linux上的实现方式</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#三、功能组件" class="sidebar-link">三、功能组件</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#四、开始安装" class="sidebar-link">四、开始安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#五、配置" class="sidebar-link">五、配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#六、测试并登陆" class="sidebar-link">六、测试并登陆</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#七、登陆问题查看日志" class="sidebar-link">七、登陆问题查看日志</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/migrated/2017-04-19-rhel6-google-authenticator/#参考连接" class="sidebar-link">参考连接</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="linux之利用google-authenticator实现用户双因素认证-red-hat-enterprise-linux-6-0"><a href="#linux之利用google-authenticator实现用户双因素认证-red-hat-enterprise-linux-6-0" class="header-anchor">#</a> Linux之利用Google Authenticator实现用户双因素认证（Red Hat Enterprise Linux 6.0)</h1> <p>2017.04.19</p> <h2 id="一、google-authenticator双因素认证"><a href="#一、google-authenticator双因素认证" class="header-anchor">#</a> 一、Google-Authenticator双因素认证</h2> <p>双因素身份认证就是通过你二个要素组合到一起进行身份认证系统，比如登陆时，不但要输入密码还需要输入动态验证码。Google-Authenticator双因素认证是一种采用时间同步技术的系统，采用了基于时间、事件和密钥三变量而产生的一次性密码来代替传统的静态密码。每个动态密码卡都有一个唯一的密钥，该密钥同时存放在服务器端，每次认证时动态密码卡与服务器分别根据同样的密钥，同样的随机参数（时间、事件）和同样的算法计算了认证的动态密码，从而确保密码的一致性，从而实现了用户的认证。
双因子身份认证机制的安全分析http://bobao.360.cn/learning/detail/2811.html</p> <h2 id="二、linux上的实现方式"><a href="#二、linux上的实现方式" class="header-anchor">#</a> 二、linux上的实现方式</h2> <p>linux登陆认证支持PAM模块（插入式验证模块 https://www.ibm.com/developerworks/cn/linux/l-pam/），将Google-Authenticator的模块配置到ssh登陆中。从而实现密码和手机动态口令的双因子认证</p> <h2 id="三、功能组件"><a href="#三、功能组件" class="header-anchor">#</a> 三、功能组件</h2> <p>手机端需要安装Google Authenticator ，
ios搜索安装，安卓可以从这里安装：酷安网 http://www.coolapk.com/apk/com.google.android.apps.authenticator2
google play, https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2</p> <p>服务器端需要安装PAM
Google Authenticator pam https://github.com/google/google-authenticator-libpam
Google Authenticator https://github.com/google/google-authenticator</p> <h2 id="四、开始安装"><a href="#四、开始安装" class="header-anchor">#</a> 四、开始安装</h2> <p>1.首先，将源改为阿里云的源，并增加RepoForge源，</p> <div class="language- extra-class"><pre class="language-text"><code>rpm -ivh http://repository.it4i.cz/mirrors/repoforge/redhat/el6/en/x86_64/rpmforge/RPMS/rpmforge-release-0.5.3-1.el6.rf.x86_64.rpm 
</code></pre></div><p>提示：下载地址从这里找 http://repoforge.org/use/</p> <p><img src="/assets/img/01-repoforge.c39d35ee.png" alt="1"></p> <p>2.依赖包安装</p> <div class="language- extra-class"><pre class="language-text"><code>yum install wget gcc gcc-g++ make
yum install autoconf automake libtool
yum install pam-devel libpng-devel qrencode chrony
</code></pre></div><p>3.下载google-authenticator-libpam，并编译安装</p> <div class="language- extra-class"><pre class="language-text"><code>wget https://github.com/google/google-authenticator-libpam/archive/1.03.zip
unzip google-authenticator-libpam-1.03.zip
cd google-authenticator-libpam-1.03
</code></pre></div><p>4.编译</p> <div class="language- extra-class"><pre class="language-text"><code>./bootstrap.sh
./configure
make
</code></pre></div><p>5.安装</p> <div class="language- extra-class"><pre class="language-text"><code>make install

注意rhel 6.0还需要执行
ln -sv /usr/local/lib/security/pam_google_authenticator.so /lib64/security/pam_google_authenticator.so

提示：如果不创建软连接，/var/log/secure会报：
sshd[14318]: PAM unable to dlopen(/lib64/security/pam_google_authenticator.so): /lib64/security/pam_google_authenticator.so: cannot open
 shared object file: No such file or directory
</code></pre></div><h2 id="五、配置"><a href="#五、配置" class="header-anchor">#</a> 五、配置</h2> <ol><li>安装配置时间同步chrony</li></ol> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/chrony.conf
server 0.cn.pool.ntp.org
server 1.cn.pool.ntp.org
server 2.cn.pool.ntp.org
server 3.cn.pool.ntp.org

/etc/init.d/chronyd restart
chronyc sources
</code></pre></div><ol start="2"><li>修改pam配置文件</li></ol> <div class="language- extra-class"><pre class="language-text"><code>(1) 改变password-auth的软连接
cd /etc/pam.d
cp password-auth password-auth-google
cp password-auth password-auth-backup
rm password-auth
ln -sv password-auth-google password-auth
(2) 修改password-auth-google文件，
auth sufficient pam_unix.so nullok try_first_pass
修改为
auth required pam_unix.so nullok try_first_pass
auth sufficient pam_google_authenticator.so nullok no_increment_hotp [authtok_prompt=verification code:] debug echo_verification_code
</code></pre></div><p>如图：</p> <p><img src="/assets/img/03.424098f8.png" alt="2"></p> <ol start="3"><li>修改ssh服务配置</li></ol> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/ssh/sshd_config
PasswordAuthentication yes
ChallengeResponseAuthentication yes
UsePAM yes
</code></pre></div><ol start="4"><li>禁用selinux，否则root用户无法登陆，会报</li></ol> <p><img src="data:image/png;base64,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" alt="3"></p> <div class="language- extra-class"><pre class="language-text"><code>#下次重启生效
vi /etc/selinux/config 
SELINUX=disabled
SELINUXTYPE=targeted

#立即生效
setenforce 0
</code></pre></div><ol start="5"><li>同步时间</li></ol> <div class="language- extra-class"><pre class="language-text"><code>ntpdate 0.cn.pool.ntp.org
</code></pre></div><ol start="6"><li>重启服务</li></ol> <div class="language- extra-class"><pre class="language-text"><code>service sshd restart
</code></pre></div><h2 id="六、测试并登陆"><a href="#六、测试并登陆" class="header-anchor">#</a> 六、测试并登陆</h2> <ol><li>新建用户test，并为test设置密码</li> <li>第一次登陆，因为没有设置过google-authenticator, 所以会提示，配置google-authenticator</li></ol> <div class="language- extra-class"><pre class="language-text"><code>google-authenticator

Do you want authentication tokens to be time-based (y/n) y

你想做的认证令牌是基于时间的吗？

Warning: pasting the following URL into your browser exposes the OTP secret to Google:
https://www.google.com/chart?chs=200x200&amp;chld=M|0&amp;cht=qr&amp;chl=otpauth://totp/root@localhost.localdomain%3Fsecret%3DN4HLEJOQHT27VCR6RX66WXB2SY%26issuer%3Dlocalhost.localdomain

[这里会有一个很大的二维码]

Your new secret key is: N4HLEJOQHT27VCR6RX66WXB2SY

这个key就是加密串，如果你有多个设备，需要把这个保存下，方便以后添加认证设备

Your verification code is 299695

输入手机上Google Authenticator的code

Your emergency scratch codes are:

下面这些key是紧急安全码，假如你的手机丢了，紧急登录用的。

44477086
92790948
29251218
26350870
30696065

Do you want me to update your &quot;/home/test/.google_authenticator&quot; file? (y/n) y

你希望我更新你的“/home/test/.google_authenticator”文件吗(y/n)？

Do you want to disallow multiple uses of the same authentication
token? This restricts you to one login about every 30s, but it increases
your chances to notice or even prevent man-in-the-middle attacks (y/n) y

你希望禁止多次使用同一个验证令牌吗?这限制你每次登录的时间大约是30秒， 但是这加大了发现或甚至防止中间人攻击的可能性(y/n)?

By default, a new token is generated every 30 seconds by the mobile app.
In order to compensate for possible time-skew between the client and the server,
we allow an extra token before and after the current time. This allows for a
time skew of up to 30 seconds between authentication server and client. If you
experience problems with poor time synchronization, you can increase the window
from its default size of 3 permitted codes (one previous code, the current
code, the next code) to 17 permitted codes (the 8 previous codes, the current
code, and the 8 next codes). This will permit for a time skew of up to 4 minutes
between client and server.
Do you want to do so? (y/n) y

默认情况下，令牌保持30秒有效;为了补偿客户机与服务器之间可能存在的时滞，

我们允许在当前时间前后有一个额外令牌。如果你在时间同步方面遇到了问题， 可以增加窗口从默认的3个可通过验证码增加到17个可通过验证码，
这将允许客户机与服务器之间的时差增加到4分钟。你希望这么做吗(y/n)?
If the computer that you are logging into is not hardened against brute-force
login attempts, you can enable rate-limiting for the authentication module.
By default, this limits attackers to no more than 3 login attempts every 30s.
Do you want to enable rate-limiting? (y/n) y

如果你登录的那台计算机没有经过固化，以防范运用蛮力的登录企图，可以对验证模块

启用尝试次数限制。默认情况下，这限制攻击者每30秒试图登录的次数只有3次。 你希望启用尝试次数限制吗(y/n)?
</code></pre></div><p>再次登陆，已经配置过google-authenticator，所以这次验证完密码，还需要验证动态验证码，如图</p> <p><img src="/assets/img/04.44f4d642.png" alt="4"></p> <h2 id="七、登陆问题查看日志"><a href="#七、登陆问题查看日志" class="header-anchor">#</a> 七、登陆问题查看日志</h2> <p>如果第一次登陆失败，</p> <div class="language- extra-class"><pre class="language-text"><code>tail -n10 /var/log/secure
</code></pre></div><h2 id="参考连接"><a href="#参考连接" class="header-anchor">#</a> 参考连接</h2> <p>https://www.antergone.com/60.html
http://www.cnblogs.com/hanyifeng/p/kevin4real.html
http://www.pool.ntp.org/zh/use.html
http://www.osyunwei.com/archives/9045.html
http://bbs.linuxtone.org/thread-10110-1-1.html</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f427a9dd.js" defer></script><script src="/assets/js/2.d4ec38ee.js" defer></script><script src="/assets/js/5.ca2e4e56.js" defer></script>
  </body>
</html>
